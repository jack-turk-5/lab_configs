{
  # socketâ€‘activation: fd3=80/tcp, fd4=443/tcp, fd5=443/udp, fd6=admin
  debug
  admin fd/6
}

http://vpn.jackturk.dev forge.jackturk.dev {
  bind fd/3 {
    protocols h1
  }
  redir https://{host}{uri} permanent
}

https://vpn.jackturk.dev forge.jackturk.dev {
  bind       fd/4 { 
    protocols h1 h2 
  }
  encode     gzip

  # 1) Preflight OPTIONS
  @preflight {
    method OPTIONS
    path   /login* /api/* /serverinfo
  }
  respond @preflight 204

  # 2) CORS headers on every response to /login and /api/*
  @cors {
    path /login* /api/* /serverinfo
  }
  # attach CORS headers to real responses so the browser will allow the payload
  header @cors Access-Control-Allow-Origin "{>Origin}"
  header @cors Access-Control-Allow-Credentials "true"

  @vpn host vpn.jackturk.dev
  handle @vpn {
    reverse_proxy /* host.containers.internal:51819 {
      header_up Host {host}                                       
      header_up X-Real-IP {remote}
      header_up Authorization {>Authorization}
    }
  }

  @forge host forge.jackturk.dev
  handle @forge {
    reverse_proxy host.containers.internal:3000 {
      header_up Host {host}                                       
      header_up X-Real-IP {remote}  
      header_up Upgrade {>Upgrade}
      header_up Connection {>Connection}                                    
      header_up Authorization {>Authorization}  
    }          
  }
}