{
  # socketâ€‘activation: fd3=80/tcp, fd4=443/tcp, fd5=443/udp, fd6=admin
  debug
  admin fd/6
}

http://vpn.jackturk.dev forge.jackturk.dev {
  bind fd/3 {
    protocols h1
  }
  redir https://{host}{uri} permanent
}

https://vpn.jackturk.dev forge.jackturk.dev {
  bind       fd/4 { 
    protocols h1 h2 
  }
  encode     gzip

  @vpn host vpn.jackturk.dev {
    @preflight {
      method OPTIONS
      path   /login* /api/* /serverinfo
    }
    # respond to any matched OPTIONS with 204 + CORS headers
    respond @preflight 204 {
      header Access-Control-Allow-Origin      "{>Origin}"
      header Access-Control-Allow-Methods     "GET, POST, OPTIONS"
      header Access-Control-Allow-Headers     "Authorization, Content-Type"
      header Access-Control-Allow-Credentials "true"
    }
    handle @vpn {
      reverse_proxy /* host.containers.internal:51819 {
        header_up Host {host}                                       
        header_up X-Real-IP {remote}
        header_up Authorization {>Authorization}
      }
    }
  }

  @forge host forge.jackturk.dev
  handle @forge {
    reverse_proxy host.containers.internal:3000 {
      header_up Host {host}                                       
      header_up X-Real-IP {remote}  
      header_up Upgrade {>Upgrade}
      header_up Connection {>Connection}                                    
      header_up Authorization {>Authorization}  
    }          
  }
}